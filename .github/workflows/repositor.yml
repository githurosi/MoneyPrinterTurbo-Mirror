name: Clone Latest OpenCorePkg Assets
on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘ï¼Œå¯æŒ‰éœ€æ·»åŠ è‡ªåŠ¨è§¦å‘ï¼ˆå¦‚å®šæ—¶ï¼‰
  schedule:
    - cron: "0 0 * * *"  # æ¯å¤©å‡Œæ™¨è‡ªåŠ¨è¿è¡Œ

permissions:
  contents: write  # éœ€å†™å…¥æƒé™ä»¥ä¿å­˜èµ„äº§

jobs:
  download-latest-assets:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»“åº“
        uses: actions/checkout@v4

      - name: è·å–æœ€æ–° Release ä¿¡æ¯
        id: get-latest-release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # éœ€åœ¨ä»“åº“ Secrets ä¸­é…ç½®
        run: |
          # è°ƒç”¨ GitHub API è·å–æœ€æ–° Release
          response=$(curl -s https://api.github.com/repos/acidanthera/OpenCorePkg/releases/latest)
          export TAG_NAME=$(echo "$response" | jq -r '.tag_name')
          export ASSETS_URL=$(echo "$response" | jq -r '.assets[0].browser_download_url')
          echo "TAG_NAME=$TAG_NAME" >> $GITHUB_OUTPUT
          echo "ASSETS_URL=$ASSETS_URL" >> $GITHUB_OUTPUT

      - name: ä¸‹è½½æœ€æ–°èµ„äº§
        if: steps.get-latest-release.outputs.ASSETS_URL != ''
        run: |
          echo "å¼€å§‹ä¸‹è½½æœ€æ–°èµ„äº§: ${{ steps.get-latest-release.outputs.TAG_NAME }}"
          wget -q --show-progress ${{ steps.get-latest-release.outputs.ASSETS_URL }} -O OpenCorePkg-latest.zip

      - name: è§£å‹èµ„äº§ï¼ˆå¯é€‰ï¼‰
        if: steps.get-latest-release.outputs.ASSETS_URL != ''
        run: |
          unzip -q OpenCorePkg-latest.zip -d OpenCoreAssets
          rm OpenCorePkg-latest.zip  # æ¸…ç†å‹ç¼©åŒ…

      - name: æäº¤æ›´æ–°
        if: steps.get-latest-release.outputs.ASSETS_URL != ''
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ“¦ æ›´æ–° OpenCorePkg åˆ° ${{ steps.get-latest-release.outputs.TAG_NAME }}"
          files: |
            OpenCorePkg-latest.zip  # ä¿ç•™å‹ç¼©åŒ…æˆ–è§£å‹åçš„æ–‡ä»¶
            OpenCoreAssets/
          commit_author: "github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>"
