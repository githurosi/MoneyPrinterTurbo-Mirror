name: Update README with OpenCore Release Notes
on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘ï¼Œå¯æŒ‰éœ€æ·»åŠ è‡ªåŠ¨è§¦å‘ï¼ˆå¦‚å®šæ—¶ï¼‰
  schedule:
    - cron: "0 0 * * *"  # æ¯å¤©å‡Œæ™¨è‡ªåŠ¨è¿è¡Œ

permissions:
  contents: write  # éœ€å†™å…¥æƒé™ä»¥æ›´æ–° README æ–‡ä»¶

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»“åº“
        uses: actions/checkout@v4

      - name: è·å–æœ€æ–° Release ä¿¡æ¯
        id: get-latest-release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # éœ€åœ¨ä»“åº“ Secrets ä¸­é…ç½®
        run: |
          # è°ƒç”¨ GitHub API è·å–æœ€æ–° Release
          response=$(curl -s https://api.github.com/repos/acidanthera/OpenCorePkg/releases/latest)
          export TAG_NAME=$(echo "$response" | jq -r '.tag_name')
          export BODY=$(echo "$response" | jq -r '.body')
          echo "TAG_NAME=$TAG_NAME" >> $GITHUB_OUTPUT
          echo "BODY=$BODY" >> $GITHUB_OUTPUT

      - name: æ£€æŸ¥å¹¶åˆ›å»ºæ—¥å¿—å±•ç¤ºåŒºåŸŸ
        run: |
          if! grep -q "## OpenCore æœ€æ–°ç‰ˆæœ¬æ›´æ–°æ—¥å¿—" README.md; then
            echo "æœªæ‰¾åˆ°æ—¥å¿—å±•ç¤ºåŒºåŸŸï¼Œæ­£åœ¨åˆ›å»º..."
            echo -e "\n## OpenCore æœ€æ–°ç‰ˆæœ¬æ›´æ–°æ—¥å¿—\n" >> README.md
          fi

      - name: æ›´æ–° README æ–‡ä»¶
        run: |
          sed -i "s/### æœ€æ–°ç‰ˆæœ¬ï¼š\[ç‰ˆæœ¬å·\]/### æœ€æ–°ç‰ˆæœ¬ï¼š${{ steps.get-latest-release.outputs.TAG_NAME }}/g" README.md
          sed -i "s/\[å…·ä½“æ›´æ–°æ—¥å¿—å†…å®¹\]/${{ steps.get-latest-release.outputs.BODY // /\\n}}/g" README.md

      - name: æäº¤æ›´æ”¹
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ“„ æ›´æ–° README ä»¥å±•ç¤º OpenCore æœ€æ–°ç‰ˆæœ¬æ—¥å¿—"
          files: README.md
          commit_author: "github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>"
