name: Test workflow  # æµ‹è¯•å·¥ä½œæµ

on:  # è§¦å‘é…ç½®å¼€å¯
  push:  # pushè§¦å‘
    branches:  # åˆ†æ”¯é™åˆ¶
      - main  # ä»…mainåˆ†æ”¯è§¦å‘
  schedule:  # å®šæ—¶ä»»åŠ¡é…ç½®
    - cron: "0 1 * * *"  # UTCæ—¶é—´1:00ï¼ˆåŒ—äº¬æ—¶é—´9:00ï¼‰
  workflow_dispatch:  # Actionsæ ‡ç­¾é¡µæ‰‹åŠ¨è§¦å‘
    inputs:  # è¾“å…¥å‚æ•°é…ç½®
      force_sync:  # å‚æ•°åç§°
        description: 'Force immediate sync'  # å¼ºåˆ¶åŒæ­¥
        type: boolean  # å‚æ•°ç±»å‹
        default: false  # é»˜è®¤å€¼

jobs:
  clone:
    runs-on: ubuntu-latest
    steps:
      - name: æ˜¾å¼æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          repository: harry0703/MoneyPrinterTurbo.git  # âœ… å®Œæ•´åœ°å€
          path: ./moneyprinter-turbo  # âœ… å”¯ä¸€è·¯å¾„
          fetch-depth: 0
          ref: main  # âœ… æŒ‡å®šåˆ†æ”¯

      - name: éªŒè¯å…‹éš†ç»“æœ
        run: |
          # æ£€æŸ¥å…³é”®æ–‡ä»¶
          test -f ./moneyprinter-turbo/README.md || exit 1
          
          # éªŒè¯åˆ†æ”¯
          cd ./moneyprinter-turbo
          CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
          [ "$CURRENT_BRANCH" = "main" ] || exit 1

      - name: å®‰å…¨æäº¤ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if: success()
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ”„ æˆåŠŸå…‹éš† MoneyPrinterTurbo"
          branch: main
          commit_user_name: "github-actions[bot]"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
