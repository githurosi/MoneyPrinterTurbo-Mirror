name: Test workflow  # 测试工作流

on:  # 触发配置开启
  push:  # push触发
    branches:  # 分支限制
      - main  # 仅main分支触发
  schedule:  # 定时任务配置
    - cron: "0 1 * * *"  # UTC时间1:00（北京时间9:00）
  workflow_dispatch:  # Actions标签页手动触发
    inputs:  # 输入参数配置
      force_sync:  # 参数名称
        description: 'Force immediate sync'  # 强制同步
        type: boolean  # 参数类型
        default: false  # 默认值

jobs:
  clone:
    runs-on: ubuntu-latest
    steps:
      - name: 显式检出仓库
        uses: actions/checkout@v4
        with:
          repository: harry0703/MoneyPrinterTurbo.git  # ✅ 完整地址
          path: ./moneyprinter-turbo  # ✅ 唯一路径
          fetch-depth: 0
          ref: main  # ✅ 指定分支

      - name: 验证克隆结果
        run: |
          # 检查关键文件
          test -f ./moneyprinter-turbo/README.md || exit 1
          
          # 验证分支
          cd ./moneyprinter-turbo
          CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
          [ "$CURRENT_BRANCH" = "main" ] || exit 1

      - name: 安全提交（如果需要）
        if: success()
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "🔄 成功克隆 MoneyPrinterTurbo"
          branch: main
          commit_user_name: "github-actions[bot]"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
